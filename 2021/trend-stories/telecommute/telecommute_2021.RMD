---
output:
  html_document:
    df_print: paged
  pdf_document:
    latex_engine: lualatex
fontsize: 12pt
header-includes:
- \usepackage{xcolor}
- \usepackage{hyperref}
- \usepackage{pdfcomment}
- "\\usepackage{fancyhdr} \\pagestyle{fancy} \\setlength{\\headheight}{75pt} \\setlength{\\textheight}{600pt}
  \\fancyhead[R]{} \\fancyfoot[L]{\\scriptsize{1011 Western Ave, Suite 500, Seattle
  WA 98104} \\textcolor[HTML]{F05A28}. 206.464.7532 \\textcolor[HTML]{F05A28}. www.psrc.org
  \\textcolor[HTML]{F05A28}. January 2023} \\fancyfoot[R]{\\textcolor[HTML]{F05A28}\\thepage}
  \\fancyfoot[C]{} \\renewcommand{\\headrulewidth}{0pt} \\renewcommand{\\footrulewidth}{4pt}
  \\renewcommand{\\footrule}{\\hbox to \\headwidth{\\color[HTML]{BCBEC0}\\leaders\\hrule
  height \\footrulewidth\\hfill}}"
- \usepackage{fontspec}
  \\fancyhead[C]{} \\fancyhead[L]{\\includegraphics{X:/DSA/shiny-uploads/images/trends-header.png}}
---
\setmainfont{Poppins}

# Trends in Employment and Telecommuting
```{r setup, include = FALSE}
library(psrcplot)
library(psrccensus)
library(tidyverse)
library(knitr)
library(magick)
library(openxlsx)
library(htmlwidgets)

source("telecommute_function.R")
# OR
#load("telecommute_tables.RData")

output_path <- "C:/GitHub/travel-studies/2021/trend-stories/telecommute/"
options(tinytex.verbose = TRUE)

# Create Image 
#image1 <- image_read("plaza_roberto.png")
#image2 <- image_read("pride_pedestrian.jpg")
#image3 <- image_read("puyallup_transit.jpg")
#image4 <-  image_read("hectors-walking.jpg")
#image5 <- image_read("northgate_cyclist.jpg")

#input <- c(image_scale(image1, "x200"), image_scale(image2, "x200"), image_scale(image3, "x200"),  image_scale(image4, "x200"),  image_scale(image5, "x200"))

#walking_image_header <- image_append(input)
#image_write(walking_image_header, path="walking_image_header.png", format="png")
#install_psrc_fonts()
#walking_image_header
```
![](C:/GitHub/travel-studies/2021/trend-stories/bike-ped/walking_image_header.png){width=100%}
\begin{flushleft}
The 2021 regional travel survey collected day-to-day information from households in the central Puget Sound region: how we traveled, where we went, how long it took - even where we chose to live and whether we got home deliveries. This report compares household travel choices in 2021, during COVID-19 conditions to that in the previous years of 2017 and 2019. Learn more at the \href{https://www.psrc.org/our-work/household-travel-survey-program}{\underline{\textcolor{blue}{PSRC household travel survey webpage}}}. You can also \href{https://household-travel-survey-psregcncl.hub.arcgis.com}{\underline{\textcolor{blue}{view the full travel survey dataset here}}}, including 2017, 2019, and 2021 data.
\end{flushleft}

## First Section: changes in workplace
\begin{flushleft}

first section text here

\end{flushleft}

```{r load_tables, echo = FALSE, results = TRUE}
# Workplace
workplace_17_19 <- get_telecommute_data(survey = "2017_2019",
                                        stat_var = "workplace",
                                        group_vars = "workplace",
                                        weight = "hh_weight_2017_2019_adult")

workplace_21 <- get_telecommute_data(survey = "2021",
                                     stat_var = "workplace",
                                     group_vars = "workplace",
                                     weight = "person_adult_weight_2021")

workplace <- bind_rows(workplace_17_19, workplace_21) %>% 
  filter(workplace != "Total")

rm(workplace_17_19, workplace_21)

# Telecommute frequency: 1+ days per week
telecommute_17 <- get_telecommute_data(survey = "2017",
                                       stat_var = "telecommute_freq_cond",
                                       group_vars = "telecommute_freq_cond",
                                       weight = "hh_weight_2017",
                                       incl_na = FALSE)

telecommute_19 <- get_telecommute_data(survey = "2019",
                                       stat_var = "telecommute_freq_cond",
                                       group_vars = "telecommute_freq_cond",
                                       weight = "hh_weight_2019",
                                       incl_na = FALSE)

telecommute_21 <- get_telecommute_data(survey = "2021",
                                       stat_var = "telecommute_freq_cond",
                                       group_vars = "telecommute_freq_cond",
                                       weight = "person_adult_weight_2021",
                                       incl_na = FALSE)

telecommute_frequency <- bind_rows(telecommute_17, telecommute_19, telecommute_21) %>% 
  filter(telecommute_freq_cond != "Total")

rm(telecommute_17, telecommute_19, telecommute_21)

# Telecommute frequency: times per week
times_17 <- get_telecommute_data(survey = "2017",
                                 stat_var = "telecommute_freq",
                                 group_vars = "telecommute_freq",
                                 weight = "hh_weight_2017",
                                 incl_na = FALSE)

times_19 <- get_telecommute_data(survey = "2019",
                                 stat_var = "telecommute_freq",
                                 group_vars = "telecommute_freq",
                                 weight = "hh_weight_2019",
                                 incl_na = FALSE)

times_21 <- get_telecommute_data(survey = "2021",
                                 stat_var = "telecommute_freq",
                                 group_vars = "telecommute_freq",
                                 weight = "person_adult_weight_2021",
                                 incl_na = FALSE)

telecommute_times_per_week <- bind_rows(times_17, times_19, times_21) %>% 
  filter(telecommute_freq != "Total")

rm(times_17, times_19, times_21)

# Telecommute frequency: gender
telecommute_freq_gender_1719 <- get_telecommute_data(survey = "2017_2019",
                                                     stat_var = "telecommute_freq",
                                                     group_vars = c("gender_group", "telecommute_freq"),
                                                     weight = "hh_weight_2017_2019_adult",
                                                     incl_na = FALSE)

telecommute_freq_gender_21 <- get_telecommute_data(survey = "2021",
                                                   stat_var = "telecommute_freq",
                                                   group_vars = c("gender_group", "telecommute_freq"),
                                                   weight = "person_adult_weight_2021",
                                                   incl_na = FALSE)

telecommute_freq_gender <- bind_rows(telecommute_freq_gender_1719, telecommute_freq_gender_21) %>% 
  filter(telecommute_freq != "Total")

rm(telecommute_freq_gender_1719, telecommute_freq_gender_21)

# Workplace travel
travel_by_gender_21 <- get_telecommute_data(survey = "2021",
                                            stat_var = "workplace_travel",
                                            group_vars = c("gender_group", "workplace_travel"),
                                            weight = "person_adult_weight_2021",
                                            incl_na = FALSE) %>% 
  filter(workplace_travel != "Total")

travel_by_race_21 <- get_telecommute_data(survey = "2021",
                                          stat_var = "workplace_travel",
                                          group_vars = c("race_category", "workplace_travel"),
                                          weight = "person_adult_weight_2021",
                                          incl_na = FALSE) %>% 
  filter(workplace_travel != "Total")

# Industry
industry_by_work_loc_21 <- get_telecommute_data(survey = "2021",
                                                stat_var = "workplace_travel",
                                                group_vars = c("industry_cond", "workplace_travel"),
                                                weight = "person_adult_weight_2021",
                                                incl_na = FALSE) %>% 
  filter(workplace_travel != "Total")

industry_by_gender_21 <- get_telecommute_data(survey = "2021",
                                              stat_var = "gender_group",
                                              group_vars = c("industry_cond", "gender_group"),
                                              weight = "person_adult_weight_2021",
                                              incl_na = FALSE) %>% 
  filter(gender_group != "Total")

industry_by_race_21 <- get_telecommute_data(survey = "2021",
                                            stat_var = "race_eth_poc",
                                            group_vars = c("industry_cond", "race_eth_poc"),
                                            weight = "person_adult_weight_2021",
                                            incl_na = FALSE) %>% 
  filter(race_eth_poc != "Total")
```

### More Social-Recreation Trips, Less Work and School Trips
\begin{flushleft}
The average number of trips per day per person decreased modestly from 4.4 trips in 2017/2019 to 4.1 trips. The types of trips people took shifted towards social-recreation trips away from work and school.
\end{flushleft}


```{r purpose, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
trips_by_purpose<-read.csv(paste0(output_path, '/trips_by_purpose.csv'))

trips_by_purpose_trend<-static_bar_chart(t=trips_by_purpose , y='simple_purpose',x='share', fill='survey', moe='share_moe',est ='percent', color="pgnobgy_5",  title= 'Percent of Trips by Purpose')



addWorksheet(wb = wb, sheetName = 'trips_by_purpose', gridLines = FALSE)
writeDataTable(wb = wb, sheet = 'trips_by_purpose', x = trips_by_purpose)
trips_by_purpose_trend
```


### A greater share of social-recreation trips were made by walking in 2021
\begin{flushleft}
Walking mode shares increased for social, recreation, and meal purposes but decreased for work and school purposes in 2021, as compared to 2017/2019.

In 2021, walking accounted for about one-third of social, recreation, and meal related trips up from one-fourth of these types of trips in 2017/2019. 
\end{flushleft}

```{r walkpurpose, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
trips_by_purpose_walk<-read.csv(paste0(output_path, '/trips_by_purpose_walk.csv'))

trips_by_purpose_walk_trend<-static_bar_chart(t=trips_by_purpose_walk , y='simple_purpose',x='share', fill='survey', moe='share_moe', est='percent', color="pgnobgy_5", title='Walk Mode Share by Purpose')


trips_by_purpose_walk_trend
addWorksheet(wb = wb, sheetName = 'trips_by_purpose_walk', gridLines = FALSE)
writeDataTable(wb = wb, sheet = 'trips_by_purpose_walk', x = trips_by_purpose_walk)

```


### 75% of transit trips were accessed by walking
\begin{flushleft}
Approximately 75\% of all transit trips were accessed by walk, jog, or wheelchair.  Access by biking accounted for less than 5\% of trips to transit in both years.  The remaining transit trips were accessed by several other modes, including driving and parking, getting dropped off, and other. 
\end{flushleft}
```{r transit-access, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
transit_access_mode<-read.csv(paste0(output_path, '/transit_access.csv'))
transit_access_chart<-static_column_chart(t=transit_access_mode, x='mode_acc_walk', y='share', fill='year', moe='share_moe', est='percent',color="pgnobgy_5", title='Transit Access Mode')
addWorksheet(wb = wb, sheetName = 'transit_access_mode', gridLines = FALSE)
writeDataTable(wb = wb, sheet = 'transit_access_mode', x = transit_access_mode)
transit_access_chart
```

### More people going for walks and bike rides
\begin{flushleft}
Most people, at around 70\%, reported going for walks, even before COVID-19. During COVID-19 the share of people who reported going for walks increased about 10\% to 80\% of adults. 

In 2021, the highest share of people reported walking 2-4 days/week, while in 2017/2019, the highest share of people reported never walking. 
\end{flushleft}
\begin{flushleft}
People were biking a little more frequently in 2021 than in 2017/2019. More people in the region biked sometimes, but less than monthly in 2021. 
\end{flushleft}


```{r walk-freq, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
walk_freq<-read.csv(paste0(output_path, '/walk_frequency.csv'))
walk_freq_chart<-static_bar_chart(t=walk_freq , y='mode_freq_3', x='share', fill='survey', moe='share_moe', est='percent',color="pgnobgy_5", title ='Share of People Going for Walks')
walk_freq_chart
addWorksheet(wb = wb, sheetName = 'walk_freq', gridLines = FALSE)
writeDataTable(wb = wb, sheet = 'walk_freq', x = walk_freq)
```


```{r bike-freq, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
bike_freq<-read.csv(paste0(output_path, '/bike_frequency.csv'))
bike_freq_chart<-static_bar_chart(t=bike_freq , y='mode_freq_2', x='share', fill='survey', moe='share_moe', est='percent',color="pgnobgy_5", title = 'Share of People Going for Bike Rides')
bike_freq_chart
addWorksheet(wb = wb, sheetName = 'bike_freq', gridLines = FALSE)
writeDataTable(wb = wb, sheet = 'bike_freq', x = bike_freq)
```

## Second Section: telecommuting trends

\begin{flushleft}

second section text here

\end{flushleft}

```{r, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
rgc_walk_mode<-read.csv(paste0(output_path, 'final_home_is_rgcwalk_mode_share.csv'))
rgc_walk_mode_chart<-static_column_chart(t=rgc_walk_mode , x='final_home_is_rgc', y='share', f='survey', moe='share_moe', est='percent', color="pgnobgy_5", title = 'Walking Trip Shares by Home Location')
rgc_walk_mode_chart

addWorksheet(wb = wb, sheetName = 'rgc_walk_mode', gridLines = FALSE)
writeDataTable(wb = wb, sheet = 'rgc_walk_mode', x = rgc_walk_mode)


```
\begin{flushleft}
\textbf{Walking by Vehicle Ownership}

People living in regional growth centers may walk more than others because they own fewer cars. People with no vehicles in their household walked on nearly \textbf{50\%} of their trips, as compared to people who have vehicle in their household walking on \textbf{13\%} of their trips.

\end{flushleft}

```{r, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
veh_walk_mode<-read.csv(paste0(output_path, 'NoVehicleswalk_mode_share.csv'))
veh_walk_mode_chart<-static_column_chart(t=veh_walk_mode , x='NoVehicles', y='share', f='survey', moe='share_moe', est='percent', color="pgnobgy_5", title='Walking Trip Mode Shares by Household Vehicle Ownership')
veh_walk_mode_chart

addWorksheet(wb = wb, sheetName = 'veh_walk_mode', gridLines = FALSE)
writeDataTable(wb = wb, sheet = 'veh_walk_mode', x = veh_walk_mode)


```
\begin{flushleft}
\textbf{Walking by race and ethnicity}

In 2021, all racial groups had higher walking shares than in 2017/2019. Interpretation of variation in mode share across the racial groups is not possible because of the wide margins of error.

\end{flushleft}

```{r, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
race_walk_mode<-read.csv(paste0(output_path, 'race_eth_broadwalk_mode_share.csv'))
race_walk_mode_chart<-static_column_chart(t=race_walk_mode , x='race_eth_broad', y='share', f='survey', moe='share_moe', est='percent', color="pgnobgy_5", title='Walking Trip Mode Shares by Race and Ethnicity')
race_walk_mode_chart

addWorksheet(wb = wb, sheetName = 'race_walk_mode', gridLines = FALSE)
writeDataTable(wb = wb, sheet = 'race_walk_mode', x = race_walk_mode)


```

## Third Section: workplace travel & industry trends in 2021
\begin{flushleft}

third section text here

\end{flushleft}

```{r, echo=FALSE, results=TRUE,  fig.dim=c(6,4)}
saveWorkbook(wb=wb, file=xlsx_file, overwrite = TRUE)

```

\subsection{Conclusion}
\begin{flushleft}

conclusion text here

\end{flushleft}

